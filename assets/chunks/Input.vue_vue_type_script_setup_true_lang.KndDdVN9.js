import{i as dt,u as Ye,n as re}from"./index._vIfVuXs.js";import{k as be,d as te,O as C,o as H,b as ie,w as P,J as w,p as r,a as q,t as Z,c as Ve,m as Xe,g9 as ft,h as a,y as ht,l as je,A as pt,ga as vt,gb as gt,S as me,Y as B,gc as mt}from"./framework.TV9jg5Us.js";import{g as wt}from"./theme.rXmDXHr-.js";function bt(e){if(!dt)return be(()=>{});const n=e!==void 0?Ye(e):Ye();return be(()=>{const{value:o}=n;if(o.length!==0)return o[o.length-1]})}var _t=Object.defineProperty,kt=(e,n,o)=>n in e?_t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,Ge=(e,n,o)=>(kt(e,typeof n!="symbol"?n+"":n,o),o),ye=(e,n,o)=>{if(!n.has(e))throw TypeError("Cannot "+o)},E=(e,n,o)=>(ye(e,n,"read from private field"),o?o.call(e):n.get(e)),O=(e,n,o)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,o)},ee=(e,n,o,i)=>(ye(e,n,"write to private field"),i?i.call(e,o):n.set(e,o),o),I=(e,n,o)=>(ye(e,n,"access private method"),o),Je=class extends Error{},yt=class extends Je{constructor(...e){super(...e),this.name="RunningTaskSkippedError"}},St=class extends Je{constructor(...e){super(...e),this.name="PendingTaskSkippedError"}},xt=class{constructor(e){Ge(this,"buffer"),this.buffer=e}},G,D,T,le,J,se,ue,Se,ce,xe,_e,Qe,ae,ke,Ct=class{constructor(e){O(this,J),O(this,ue),O(this,ce),O(this,_e),O(this,ae),Ge(this,"worker"),O(this,G,void 0),O(this,D,[]),O(this,T,null),O(this,le,{}),ee(this,G,e),this.worker=new Worker(e),I(this,J,se).call(this)}register(e){return(...n)=>new Promise((o,i)=>I(this,_e,Qe).call(this,{name:e,args:n,transferableIndices:[],resolve:o,reject:i}))}skip(){return I(this,ae,ke).call(this)?(this.worker=new Worker(E(this,G)),I(this,J,se).call(this),I(this,ce,xe).call(this),!0):!1}skipAll(){if(!I(this,ae,ke).call(this))return!1;for(const{reject:e}of E(this,D))e(new St("Pending task skipped."));return ee(this,D,[]),this.worker=new Worker(E(this,G)),I(this,J,se).call(this),!0}control(e,n){E(this,le)[e]=n}};G=new WeakMap;D=new WeakMap;T=new WeakMap;le=new WeakMap;J=new WeakSet;se=function(){this.worker.onmessage=e=>{const{type:n}=e.data;if(n==="control"){const{name:o,args:i}=e.data,h=E(this,le)[o];h?h(...i):console.warn(`No handler for command ${o}`)}else{const{args:o,transferableIndices:i,resolve:h,reject:d}=E(this,T);if(ee(this,T,null),I(this,ce,xe).call(this),n==="success"){const{result:c,transferables:u}=e.data;u.forEach((p,y)=>{o[i[y]].buffer=p}),h(c)}else{const{name:c,message:u}=e.data.error,p=new Error(u);p.name=c,d(p)}}}};ue=new WeakSet;Se=function(e){const{name:n,args:o,transferableIndices:i}=e,h=[],d=o.map((c,u)=>c&&c.constructor===xt?(i.push(u),h.push(c.buffer),c.buffer):c);ee(this,T,e),this.worker.postMessage({name:n,args:d,transferableIndices:i},h)};ce=new WeakSet;xe=function(){if(E(this,D).length){const e=E(this,D).shift();I(this,ue,Se).call(this,e)}};_e=new WeakSet;Qe=function(e){E(this,T)?E(this,D).push(e):I(this,ue,Se).call(this,e)};ae=new WeakSet;ke=function(){if(!E(this,T))return!1;this.worker.terminate();const{reject:e}=E(this,T);return e(new yt("Running task skipped.")),ee(this,T,null),!0};const Ze=Symbol(),Ce=Symbol(),Ee=Symbol(),et=Symbol(),tt=Symbol(),nt=Symbol(),ot=Symbol(),st=Symbol(),Me=Symbol();class Et{constructor(){const n=new Ct("/worker.js");this.worker=n,this.setIME=n.register("setIME"),this.setOption=n.register("setOption"),this.setPageSize=n.register("setPageSize"),this.process=n.register("process"),this.selectCandidateOnCurrentPage=n.register("selectCandidateOnCurrentPage"),this.resetUserDirectory=n.register("resetUserDirectory")}}const Mt=bt(),Lt=be(()=>Mt.value==="xs"),Pt="#container textarea";function Q(){return document.querySelector(Pt)}const It=te({__name:"Menu",props:{disableSwitch:{type:Boolean}},setup(e){const{NButton:n,NButtonGroup:o,NSpace:i,NSelect:h}=re,d=e,c=C(Ze),u=C(Ce),p=[{label:"声笔简码",value:"sbjm"},{label:"声笔拼音",value:"sbpy"},{label:"声笔飞码",value:"sbfm"},{label:"声笔飞单",value:"sbfd"},{label:"声笔飞讯",value:"sbfx"},{label:"声笔小鹤",value:"sbxh"},{label:"声笔自然",value:"sbzr"}],y=C(Ee),f=C(et),v=C(Me),b=C(tt);function M(){Q().focus()}function _(W){M(),u(W)}return(W,x)=>(H(),ie(r(i),null,{default:P(()=>[w(r(h),{style:{width:"160px"},value:r(c),options:p,loading:r(y),"onUpdate:value":_,disabled:d.disableSwitch},null,8,["value","loading","disabled"]),w(r(o),{class:"square-group",onClick:M},{default:P(()=>[w(r(n),{secondary:"",onClick:r(v)},{default:P(()=>[q(Z(r(f)?"En":"中"),1)]),_:1},8,["onClick"]),w(r(n),{secondary:"",disabled:r(f),onClick:x[0]||(x[0]=()=>{})},{default:P(()=>[q(Z(r(b)?".":"。"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}}),Wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 192 512"},Bt=Xe("path",{d:"M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z",fill:"currentColor"},null,-1),Ot=[Bt],Tt=te({name:"CaretLeft",render:function(n,o){return H(),Ve("svg",Wt,Ot)}}),At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 192 512"},Rt=Xe("path",{d:"M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z",fill:"currentColor"},null,-1),Nt=[Rt],$t=te({name:"CaretRight",render:function(n,o){return H(),Ve("svg",At,Nt)}});var at={exports:{}};(function(e){(function(){var n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],o=typeof window<"u",i=o&&window.mozInnerScreenX!=null;function h(d,c,u){if(!o)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var p=u&&u.debug||!1;if(p){var y=document.querySelector("#input-textarea-caret-position-mirror-div");y&&y.parentNode.removeChild(y)}var f=document.createElement("div");f.id="input-textarea-caret-position-mirror-div",document.body.appendChild(f);var v=f.style,b=window.getComputedStyle?window.getComputedStyle(d):d.currentStyle,M=d.nodeName==="INPUT";v.whiteSpace="pre-wrap",M||(v.wordWrap="break-word"),v.position="absolute",p||(v.visibility="hidden"),n.forEach(function(x){M&&x==="lineHeight"?v.lineHeight=b.height:v[x]=b[x]}),i?d.scrollHeight>parseInt(b.height)&&(v.overflowY="scroll"):v.overflow="hidden",f.textContent=d.value.substring(0,c),M&&(f.textContent=f.textContent.replace(/\s/g," "));var _=document.createElement("span");_.textContent=d.value.substring(c)||".",f.appendChild(_);var W={top:_.offsetTop+parseInt(b.borderTopWidth),left:_.offsetLeft+parseInt(b.borderLeftWidth),height:parseInt(b.lineHeight)};return p?_.style.backgroundColor="#aaa":document.body.removeChild(f),W}e.exports=h})()})(at);var Dt=at.exports;const zt=wt(Dt),Ut=te({__name:"Panel",props:{debugMode:{type:Boolean}},setup(e,{expose:n}){const o=C(nt),i=C(ot),h=C(Ee),d=C(st),c=C(Ce),u=C(Me),{NPopover:p,NMenu:y,NText:f,NButton:v,NIcon:b}=re,M=e,{debugMode:_}=ft(M),W=a(0),x=a(0),R=a(!1),F=a(!1),z=a(0),g=a(0),m=a(""),S=a(""),Y=a(""),de=a([]),Le=a(0),Pe=a(!0),Ie=a(!1),N=a(!1),V=a(!1),We=a(!1),ne=a(!1);async function rt(t,s){N.value=!0,await U(s),t.target.focus()}const Be={Escape:"Escape",F4:"F4",Backspace:"BackSpace",Delete:"Delete",Tab:"Tab",Enter:"Return",Home:"Home",End:"End",PageUp:"Page_Up",PageDown:"Page_Down",Alt:"Alt_L",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",ArrowLeft:"Left","~":"asciitilde","`":"quoteleft","!":"exclam","@":"at","#":"numbersign",$:"dollar","%":"percent","^":"asciicircum","&":"ampersand","*":"asterisk","(":"parenleft",")":"parenright","-":"minus",_:"underscore","+":"plus","=":"equal","{":"braceleft","[":"bracketleft","}":"braceright","]":"bracketright",":":"colon",";":"semicolon",'"':"quotedbl","'":"apostrophe","|":"bar","\\":"backslash","<":"less",",":"comma",">":"greater",".":"period","?":"question","/":"slash"," ":"space"},it=["`"];function Oe(t){return/^[a-z0-9!"#$%&'()*+,./:;<=>?@[\] ^_`{|}~\\-]$/i.test(t)}function fe(t){const s=Q(),{selectionStart:l,selectionEnd:k}=s;i.value=i.value.slice(0,l)+t+i.value.slice(k),me(()=>{s.selectionEnd=l+t.length})}async function Te(t,s){const l=Q();!("updatedSchema"in t)&&t.updatedOptions&&d(t.updatedOptions),t.state===0?(N.value=!1,V.value=!1,F.value=!1,fe(t.committed)):t.state===1?(m.value=t.head,S.value=t.body,Y.value=t.tail,Le.value=t.highlighted,de.value=t.candidates.map((k,$)=>{var K;let j=`${((K=t.selectLabels)==null?void 0:K[$])||$+1} ${k.text}`;return k.comment&&(j+=" "+k.comment),{label:j,key:$}}),Pe.value=t.page===0,Ie.value=t.isLastPage,V.value||(V.value=!0,We.value=!1),me(()=>{document.querySelector(".n-popover").getBoundingClientRect().width>l.getBoundingClientRect().width&&(We.value=!0)}),t.committed&&fe(t.committed)):(N.value=!1,V.value=!1,t.state===2&&t.updatedSchema&&await c(t.updatedSchema.split("/")[0]),t.state===3&&Oe(s)&&fe(s)),l.focus()}async function U(t){const s=await o.value.process(t);return Te(s,t)}let he=!1,X=0,pe=0;ht(i,(t,s)=>{if(he&&(he=!1,s.length+1===t.length&&s.substring(0,X)===t.substring(0,X)&&s.substring(pe)===t.substring(pe+1))){const l=Q();i.value=s,me(()=>{N.value=!0,l.selectionEnd=X,U(t[X])})}});function Ae(t){if(_.value||h.value)return;const{code:s,key:l}=t,k=Q();if(l==="Unidentified"){he=!0,X=k.selectionStart,pe=k.selectionEnd;return}if(l==="Shift"){ne.value=!0;return}ne.value=!1;const $=Oe(l),j=l==="Alt",K=t.getModifierState("Control"),Ke=t.getModifierState("Meta"),qe=t.getModifierState("Alt"),ve=t.getModifierState("Shift"),He=K||Ke||qe||ve&&!$;if(!N.value&&(document.activeElement!==k||!$&&l!=="F4"||He&&!ve&&!(K&&it.includes(l))))return;let A;const Fe=L=>`{${L}}`;if(He||!$){if(A=/^[0-9a-z]$/i.test(l)?l:Be[l],A===void 0)return;j&&s==="AltRight"&&(A="Alt_R");const L=[];K&&L.push("Control"),Ke&&L.push("Meta"),qe&&!j&&L.push("Alt"),ve&&L.push("Shift"),L.push(A),A=Fe(L.join("+"))}else s.startsWith("Numpad")?A=Fe(`KP_${s.substring(6)}`):A=l;if(!F.value){const L=k.getBoundingClientRect(),ge=zt(k,k.selectionStart);z.value=L.x+ge.left,g.value=Lt.value?8:L.y+ge.top+ge.height-k.scrollTop}N.value=!0,t.preventDefault(),U(A)}function Re(t){if(_.value||h.value)return;const{key:s}=t;s==="Shift"&&ne.value&&u(),ne.value=!1,N.value&&U(`{Release+${Be[s]||s}}`)}async function lt(t){const s=JSON.parse(await o.value.selectCandidateOnCurrentPage(t));return Te(s,"")}function Ne(t){return t.touches.length===1?t.touches[0]:void 0}function $e(t,s){W.value=t,x.value=s;const l=document.querySelector(".n-popover");z.value=l.getBoundingClientRect().left,R.value=!0}function ct(t){$e(t.clientX,t.clientY)}function ut(t){const s=Ne(t);s&&$e(s.clientX,s.clientY)}function De(t,s){R.value&&(F.value=!0,z.value+=t-W.value,g.value+=s-x.value,W.value=t,x.value=s)}function ze(t){De(t.clientX,t.clientY)}function Ue(t){const s=Ne(t);s&&De(s.clientX,s.clientY)}function oe(){R.value=!1}return je(()=>{document.addEventListener("keydown",Ae),document.addEventListener("keyup",Re),document.addEventListener("mousemove",ze),document.addEventListener("touchmove",Ue),document.addEventListener("mouseup",oe),document.addEventListener("touchend",oe)}),pt(()=>{document.removeEventListener("keydown",Ae),document.removeEventListener("keyup",Re),document.removeEventListener("mousemove",ze),document.removeEventListener("touchmove",Ue),document.removeEventListener("mouseup",oe),document.removeEventListener("touchend",oe)}),n({debug:rt}),(t,s)=>(H(),ie(r(p),{show:V.value,"show-arrow":!1,x:z.value,y:g.value,flip:!R.value,placement:"bottom-start",trigger:"manual",style:{cursor:"move"},onMousedown:ct,onTouchstart:ut},{default:P(()=>[w(r(f),{type:"success"},{default:P(()=>[q(Z(m.value),1)]),_:1}),q("  "),w(r(f),{type:"info"},{default:P(()=>[q(Z(S.value),1)]),_:1}),q("  "+Z(Y.value)+" ",1),vt(w(r(y),{options:de.value,mode:"horizontal",value:Le.value,"onUpdate:value":lt},null,8,["options","value"]),[[gt,de.value.length]]),w(r(v),{text:"",disabled:Pe.value},{default:P(()=>[w(r(b),{component:r(Tt),onClick:s[0]||(s[0]=l=>U("-"))},null,8,["component"])]),_:1},8,["disabled"]),w(r(v),{text:"",disabled:Ie.value},{default:P(()=>[w(r(b),{component:r($t),onClick:s[1]||(s[1]=l=>U("="))},null,8,["component"])]),_:1},8,["disabled"])]),_:1},8,["show","x","y","flip"]))}}),we="ascii_mode",Kt="ascii_punct",Yt=te({__name:"Input",props:{method:{},disableSwitch:{type:Boolean}},setup(e){const{NConfigProvider:n,darkTheme:o}=re,{NInput:i,NSpace:h}=re,d=e;function c(g){v.value=g,f.value=g?"":y.value}const u=a(void 0),p=a(""),y=a(d.method??"sbjm"),f=a(""),v=a(!0),b=a(!1),M=a(!1),_={[we]:b,[Kt]:M},x=(g=>async()=>{const m=_[g],S=!m.value;await u.value.setOption(g,S),m.value=S})(we);async function R(g){c(!0);try{await u.value.setIME(g),y.value=g;for(const[m,S]of Object.entries(_)){if(m===we){S.value=!1;continue}await u.value.setOption(m,S.value)}}catch(m){console.error(m)}c(!1)}function F(g){if(g.length===1){const m=g[0];for(const[S,Y]of Object.entries(_)){if(S===m){Y.value=!0;return}if(`!${S}`===m){Y.value=!1;return}}}}B(Ze,f),B(Ce,R),B(Ee,v),B(et,b),B(tt,M),B(Me,x),B(ot,p),B(st,F),B(nt,u),je(async()=>{u.value=new Et,await R(y.value)});const z=a();return(g,m)=>(H(),ie(r(n),{theme:r(o)},{default:P(()=>[(H(),ie(mt,null,[w(r(h),{vertical:""},{default:P(()=>[w(It,{"disable-switch":d.disableSwitch},null,8,["disable-switch"]),w(r(i),{id:"container",value:p.value,"onUpdate:value":m[0]||(m[0]=S=>p.value=S),type:"textarea",rows:15},null,8,["value"]),w(Ut,{ref_key:"panel",ref:z},null,512)]),_:1})],1024))]),_:1},8,["theme"]))}});export{Yt as _};
